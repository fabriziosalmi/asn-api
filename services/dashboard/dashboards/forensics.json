{
    "annotations": {
        "list": [
            {
                "builtIn": 1,
                "datasource": "-- Grafana --",
                "enable": true,
                "hide": true,
                "iconColor": "rgba(0, 211, 255, 1)",
                "name": "Annotations & Alerts",
                "type": "dashboard"
            }
        ]
    },
    "editable": true,
    "fiscalYearStartMonth": 0,
    "graphTooltip": 0,
    "id": null,
    "links": [],
    "liveNow": true,
    "panels": [
        {
            "datasource": {
                "type": "grafana-clickhouse-datasource",
                "uid": "clickhouse-asn"
            },
            "gridPos": {
                "h": 10,
                "w": 12,
                "x": 0,
                "y": 0
            },
            "id": 1,
            "options": {
                "footer": {
                    "enablePagination": true,
                    "fields": "",
                    "rowCount": false,
                    "show": false
                }
            },
            "targets": [
                {
                    "datasource": {
                        "type": "grafana-clickhouse-datasource",
                        "uid": "clickhouse-asn"
                    },
                    "format": 1,
                    "query": "SELECT timestamp, toString(asn) as asn, community FROM bgp_events WHERE timestamp >= $__fromTime AND timestamp <= $__toTime AND notEmpty(community) ORDER BY timestamp DESC LIMIT 50",
                    "rawSql": "SELECT timestamp, toString(asn) as asn, community FROM bgp_events WHERE timestamp >= $__fromTime AND timestamp <= $__toTime AND notEmpty(community) ORDER BY timestamp DESC LIMIT 50",
                    "rawQuery": true,
                    "refId": "A"
                }
            ],
            "title": "BGP Community Stream (Real-Time)",
            "type": "table"
        },
        {
            "datasource": {
                "type": "grafana-clickhouse-datasource",
                "uid": "clickhouse-asn"
            },
            "gridPos": {
                "h": 10,
                "w": 12,
                "x": 12,
                "y": 0
            },
            "id": 2,
            "options": {
                "footer": {
                    "enablePagination": true,
                    "fields": "",
                    "rowCount": false,
                    "show": false
                }
            },
            "targets": [
                {
                    "datasource": {
                        "type": "grafana-clickhouse-datasource",
                        "uid": "clickhouse-asn"
                    },
                    "format": 1,
                    "query": "SELECT toString(asn) as asn, count() as excessive_prepends FROM bgp_events WHERE timestamp >= $__fromTime AND timestamp <= $__toTime AND length(path) - length(arrayDistinct(path)) > 3 GROUP BY asn ORDER BY excessive_prepends DESC LIMIT 20",
                    "rawSql": "SELECT toString(asn) as asn, count() as excessive_prepends FROM bgp_events WHERE timestamp >= $__fromTime AND timestamp <= $__toTime AND length(path) - length(arrayDistinct(path)) > 3 GROUP BY asn ORDER BY excessive_prepends DESC LIMIT 20",
                    "rawQuery": true,
                    "refId": "A"
                }
            ],
            "title": "Top Path Prependers (Traffic Eng. Chaos)",
            "type": "table"
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "postgres-asn"
            },
            "gridPos": {
                "h": 8,
                "w": 24,
                "x": 0,
                "y": 10
            },
            "id": 3,
            "options": {
                "footer": {
                    "enablePagination": true,
                    "fields": "",
                    "rowCount": false,
                    "show": false
                }
            },
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "postgres-asn"
                    },
                    "format": "table",
                    "group": [],
                    "metricColumn": "None",
                    "rawQuery": true,
                    "rawSql": "SELECT asn, whois_entropy, is_zombie_asn FROM asn_signals WHERE whois_entropy > 4.5 OR is_zombie_asn = TRUE ORDER BY whois_entropy DESC LIMIT 50",
                    "refId": "A",
                    "table": "asn_signals",
                    "timeColumn": "updated_at",
                    "timeColumnType": "timestamp",
                    "where": []
                }
            ],
            "title": "Identity Anomalies (High Entropy & Zombie ASNs)",
            "type": "table"
        }
    ],
    "refresh": "5s",
    "schemaVersion": 38,
    "style": "dark",
    "tags": [
        "forensics",
        "asn"
    ],
    "templating": {
        "list": []
    },
    "time": {
        "from": "now-6h",
        "to": "now"
    },
    "timepicker": {},
    "timezone": "",
    "title": "Forensics Detective",
    "uid": "asn-forensics-u1",
    "version": 1,
    "weekStart": ""
}